# Migration `20200526005727-init`

This migration has been generated by I Chen Wu at 5/26/2020, 12:57:27 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Customer" (
"address" text  NOT NULL ,"avatar" text  NOT NULL ,"birthday" timestamp(3)  NOT NULL ,"city" text  NOT NULL ,"email" text  NOT NULL ,"first_name" text  NOT NULL ,"first_seen" timestamp(3)  NOT NULL ,"groups" text []  ,"has_newsletter" boolean  NOT NULL ,"has_ordered" boolean  NOT NULL ,"id" SERIAL,"last_name" text  NOT NULL ,"last_seen" timestamp(3)  NOT NULL ,"latest_purchase" text  NOT NULL ,"nb_commands" integer  NOT NULL ,"total_spent" integer  NOT NULL ,"zipcode" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Category" (
"id" SERIAL,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Product" (
"categoryId" integer   ,"description" text  NOT NULL ,"height" Decimal(65,30)  NOT NULL ,"id" SERIAL,"image" text  NOT NULL ,"price" Decimal(65,30)  NOT NULL ,"reference" text  NOT NULL ,"stock" integer  NOT NULL ,"thumbnail" text  NOT NULL ,"width" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Command" (
"basket" jsonb  NOT NULL ,"customerId" integer  NOT NULL ,"date" timestamp(3)  NOT NULL ,"deliverFees" Decimal(65,30)  NOT NULL ,"id" SERIAL,"reference" text  NOT NULL ,"returned" boolean  NOT NULL ,"status" text  NOT NULL ,"taxRate" Decimal(65,30)  NOT NULL ,"taxes" Decimal(65,30)  NOT NULL ,"total" Decimal(65,30)  NOT NULL ,"totalExTaxes" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Invoice" (
"commandId" integer  NOT NULL ,"customerId" integer  NOT NULL ,"date" timestamp(3)  NOT NULL ,"deliverFees" Decimal(65,30)  NOT NULL ,"id" SERIAL,"taxRate" Decimal(65,30)  NOT NULL ,"taxes" Decimal(65,30)  NOT NULL ,"total" Decimal(65,30)  NOT NULL ,"totalExTaxes" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Review" (
"commandId" integer  NOT NULL ,"comment" text  NOT NULL ,"customerId" integer  NOT NULL ,"date" timestamp(3)  NOT NULL ,"id" SERIAL,"productId" integer  NOT NULL ,"rating" integer  NOT NULL ,"status" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Product" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."Category"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Command" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Invoice" ADD FOREIGN KEY ("commandId")REFERENCES "public"."Command"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Invoice" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Review" ADD FOREIGN KEY ("commandId")REFERENCES "public"."Command"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Review" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Review" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200526005727-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,98 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("PRISMA_POSTGRES_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Customer {
+  id              Int       @default(autoincrement()) @id
+  first_name      String
+  last_name       String
+  email           String
+  address         String
+  zipcode         String
+  city            String
+  avatar          String
+  birthday        DateTime
+  first_seen      DateTime
+  last_seen       DateTime
+  has_ordered     Boolean
+  latest_purchase String
+  has_newsletter  Boolean
+  groups          String[]
+  nb_commands     Int
+  total_spent     Int
+  Review          Review[]
+  Invoice         Invoice[]
+  Command         Command[]
+}
+
+model Category {
+  id      Int       @default(autoincrement()) @id
+  name    String
+  Product Product[]
+}
+
+model Product {
+  id          Int       @default(autoincrement()) @id
+  category    Category? @relation(fields: [categoryId], references: [id])
+  categoryId  Int?
+  reference   String
+  width       Float
+  height      Float
+  price       Float
+  thumbnail   String
+  image       String
+  description String
+  stock       Int
+  Review      Review[]
+}
+
+model Command {
+  id           Int       @default(autoincrement()) @id
+  reference    String
+  date         DateTime
+  customerId   Int
+  customer     Customer  @relation(fields: [customerId], references: [id])
+  basket       Json
+  totalExTaxes Float
+  deliverFees  Float
+  taxRate      Float
+  taxes        Float
+  total        Float
+  status       String
+  returned     Boolean
+  Invoice      Invoice[]
+  Review       Review[]
+}
+
+model Invoice {
+  id           Int      @default(autoincrement()) @id
+  date         DateTime
+  commandId    Int
+  command      Command  @relation(fields: [commandId], references: [id])
+  customerId   Int
+  customer     Customer @relation(fields: [customerId], references: [id])
+  totalExTaxes Float
+  deliverFees  Float
+  taxRate      Float
+  taxes        Float
+  total        Float
+}
+
+model Review {
+  id         Int      @default(autoincrement()) @id
+  date       DateTime
+  status     String
+  commandId  Int
+  command    Command  @relation(fields: [commandId], references: [id])
+  productId  Int
+  product    Product  @relation(fields: [productId], references: [id])
+  customerId Int
+  customer   Customer @relation(fields: [customerId], references: [id])
+  rating     Int
+  comment    String
+}
```


